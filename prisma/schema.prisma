generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Event {
  id           String        @id
  name         String
  date         DateTime
  adminId      String
  draws        Draw[]
  admin        Admin         @relation(fields: [adminId], references: [id])
  participants Participant[]
}

model Participant {
  id                 String         @id
  name               String
  email              String?        @unique
  avatar             String?
  eventId            String
  hasDrawn           Boolean        @default(false)
  drawsAsGiver       Draw[]         @relation("DrawGiver")
  drawsAsReceiver    Draw[]         @relation("DrawReceiver")
  exclusionsReceived Exclusion[]    @relation("ExclusionExcluded")
  exclusionsGiven    Exclusion[]    @relation("ExclusionGiver")
  loginTokens        LoginToken[]
  event              Event          @relation(fields: [eventId], references: [id])
  unwanted           UnwantedHint[]
  wanted             WantedHint[]
}

model LoginToken {
  id            String      @id
  token         String      @unique
  participantId String
  expiresAt     DateTime
  createdAt     DateTime    @default(now())
  usedAt        DateTime?
  participant   Participant @relation(fields: [participantId], references: [id])
}

model Admin {
  id            String  @id
  username      String  @unique
  password_hash String
  name          String
  events        Event[]
}

model Draw {
  id         String      @id @default(cuid())
  eventId    String
  giverId    String
  receiverId String
  createdAt  DateTime    @default(now())
  event      Event       @relation(fields: [eventId], references: [id])
  giver      Participant @relation("DrawGiver", fields: [giverId], references: [id])
  receiver   Participant @relation("DrawReceiver", fields: [receiverId], references: [id])

  @@unique([eventId, giverId])
  @@unique([eventId, receiverId])
}

model Exclusion {
  id         String      @id @default(cuid())
  giverId    String
  excludedId String
  excluded   Participant @relation("ExclusionExcluded", fields: [excludedId], references: [id])
  giver      Participant @relation("ExclusionGiver", fields: [giverId], references: [id])

  @@unique([giverId, excludedId])
}

model WantedHint {
  id            String      @id @default(cuid())
  participantId String
  hint          String
  participant   Participant @relation(fields: [participantId], references: [id])

  @@index([participantId])
}

model UnwantedHint {
  id            String      @id @default(cuid())
  participantId String
  hint          String
  participant   Participant @relation(fields: [participantId], references: [id])

  @@index([participantId])
}
